<%- include("../partials/user/header") %>
  <style>
    .card-green {
      background-color: #ADD8E6;
    }

    .main {
      padding: 30px 0;
    }

    .dashboard-menu {
      background-color: #cce3e6;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .dashboard-menu .nav-link {
      font-weight: bold;
      color: #30683c;
      box-shadow: 0 4px 10px rgba(123, 131, 112, 0.3), 0 4px 20px rgba(0, 191, 255, 0.2);
      transition: box-shadow 0.3s ease;
    }

    .dashboard-menu .nav-link:hover {
      color: #00bfff;
      box-shadow: 0 4px 15px rgba(173, 255, 47, 0.5), 0 6px 25px rgba(0, 191, 255, 0.4);
    }

    .card {
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      margin-bottom: 20px;
    }

    .card-header {
      background-color: #487379;
      color: white;
      border-radius: 10px 10px 0 0;
    }

    .btn {
      margin-top: 10px;
    }

    .btn-success {
      background-color: #577194;
      border-color: #6bb87d;
    }

    .btn-success:hover {
      background-color: #506955;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .required {
      color: red;
    }

    @media (max-width: 768px) {
      .dashboard-menu {
        padding: 10px;
      }

      .card {
        margin-bottom: 15px;
      }
    }

    .page-header.breadcrumb-wrap {
      background-color: #eee2e9;
      padding: 15px 0;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      font-family: 'Arial', sans-serif;
      font-size: 16px;
      color: #121311;
    }

    .breadcrumb a {
      color: #007bff;
      text-decoration: none;
      position: relative;
      margin: 0 5px;
    }

    .breadcrumb a:hover {
      color: #0056b3;
    }

    .breadcrumb span {
      margin: 0 5px;
      color: #999;
    }

    .breadcrumb a::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 2px;
      background: #6e6e3a;
      left: 0;
      bottom: -2px;
      transform: scaleX(0);
      transition: transform 0.3s ease;
    }

    .breadcrumb a:hover::after {
      transform: scaleX(1);
    }

    .orders-container {
      max-height: 500px;
      overflow-y: scroll;
    }

    .order-card {
      margin-bottom: 10px;
    }
  </style>

  <main class="main">
    <!-- <div class="page-header breadcrumb-wrap mb-3">
    <div class="container">
      <div class="breadcrumb">
        <a href="#" rel="nofollow">Home</a>
        <span></span> Profile <span></span> Account
      </div>
    </div>
  </div> -->

    <section class="pt-10 pb-10">
      <div class="container">
        <div class="row">
          <div class="col-lg-10 m-auto">
            <div class="row">
              <div class="col-md-4">
                <div class="dashboard-menu">
                  <ul class="nav flex-column" role="tablist">
                    <li class="nav-item">
                      <a class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" href="#dashboard" role="tab"
                        aria-controls="dashboard" aria-selected="false">
                        <i class="fi-rs-settings-sliders mr-10"></i>Dashboard
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="address-tab" data-bs-toggle="tab" href="#address" role="tab"
                        aria-controls="address" aria-selected="true">
                        <i class="fi-rs-marker mr-10"></i>My Address
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="orders-tab" data-bs-toggle="tab" href="#orders" role="tab"
                        aria-controls="orders" aria-selected="false">
                        <i class="fi-rs-shopping-bag mr-10"></i>Orders
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#wallet" role="tab"
                        aria-controls="track-orders" aria-selected="false">
                        <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet History
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#wallet-history" role="tab"
                        aria-controls="track-orders" aria-selected="false">
                        <i class="fi-rs-shopping-cart-check mr-10"></i>Wallet
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" id="track-orders-tab" data-bs-toggle="tab" href="#referal" role="tab"
                        aria-controls="track-orders" aria-selected="false">
                        <i class="fi-rs-shopping-cart-check mr-10"></i>Referals
                      </a>
                    </li>
                    <li class="nav-item">
                      <a class="nav-link" href="/logout">
                        <i class="fi-rs-sign-out mr-10"></i>Logout
                      </a>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="col-md-8">
                <div class="tab-content dashboard-content">
                  <!-- Dashboard -->
                  <div class="tab-pane fade show active" id="dashboard" role="tabpanel" aria-labelledby="dashboard-tab">
                    <div class="card card-green">
                      <div class="card-header">
                        <h5 class="mb-0 text-center">User Profile</h5>
                      </div>
                      <div class="card-body text-center">
                        <h5 class="card-title">
                          <%= user.name %>
                            <a href="/edit-profile" class="edit-icon" title="Edit Username">
                              <i class="fas fa-pencil-alt"></i>
                            </a>
                        </h5>
                        <p class="card-text"><strong>Phone:</strong>
                          <%= user.phone %>
                        </p>
                        <p class="card-text"><strong>Email:</strong>
                          <%= user.email %>
                        </p>
                        <% if(!user.googleId) { %>
                          <a href="/change-email" class="btn btn-sm btn-success ml-2">Change Email</a>
                          <a href="/change-password" class="btn btn-sm btn-success">Change Password</a>
                          <% } %>
                      </div>
                    </div>
                  </div>

                  <div class="tab-pane fade" id="address" role="tabpanel" aria-labelledby="address-tab">
                    <div class="row">
                      <% if (addresses.length> 0) { %>
                        <% addresses.forEach(address=> { %>
                          <div class="col-lg-6">
                            <div class="card mb-3 mb-lg-0">
                              <div class="card-header">
                                <h5 class="mb-0">Address</h5>
                              </div>
                              <div class="card-body">
                                <address>
                                  <strong>
                                    <%= address.address[0].name%>
                                  </strong><br> <!-- Adjust to access the name -->
                                  <%= address.address[0].addressDetail || '' %><br>
                                    <%= address.address[0].landMark %>
                                      ,<%= address.address[0].state %>
                                        <%= address.address[0].pincode %><br>
                                          <strong>Phone:</strong>
                                          <%= address.address[0].phone %><br>
                                            <% if (address.address[0].altPhone) { %>
                                              <strong>Alternate Phone:</strong>
                                              <%= address.address[0].altPhone %><br>
                                                <% } %>
                                </address>
                                <div class="d-flex justify-content-between">
                                  <a href="/editAddress/<%= address._id %>" class="btn-small">Edit</a>
                                  <a href="#" class="btn-small"
                                    onclick="deleteAddress('<%= address._id %>'); return false;">Delete</a>
                                </div>
                              </div>
                            </div>
                          </div>
                          <% }) %>
                            <% } else { %>
                              <div class="col-lg-6">
                                <div class="card mb-3 mb-lg-0">
                                  <div class="card-header">
                                    <h5 class="mb-0">No Addresses Found</h5>
                                  </div>
                                  <div class="card-body">
                                    <p>No addresses available. Please add your address.</p>
                                  </div>
                                </div>
                              </div>
                              <% } %>
                                <div>
                                  <a href="/addAddress">
                                    <button class="btn btn-primary w-70">Add address</button>
                                  </a>
                                </div>
                    </div>
                  </div>
                  <!-- Orders -->
                  <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                    <div class="card">
                      <div class="card-header">
                        <h5 class="mb-0">Your Orders</h5>
                      </div>
                      <div class="card-body orders-container" style="max-height: 400px; overflow-y: auto;">
                        <div class="table-responsive">
                          <table class="table">
                            <thead style="position: sticky; top: 0; background-color: #ffffff; z-index: 1;">
                              <tr>
                                <th>Order</th>
                                <th>Status</th>
                                <th>Payment</th>
                                <th>Total</th>
                                <th>Actions</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% if (orders && orders.length > 0) { %>
                                <% orders.reverse().forEach(order => { %>
                                  <tr class="order-card">
                                    <td>
                                      <%= order.orderId %>
                                    </td>
                                    <td>
                                      <%= order.status %>
                                    </td>
                                    <td>
                                      <%= order.paymentMethod %>
                                    </td>
                                    <td>₹<%= order.finalAmount %></td>
                                    <td>
                                      <!-- Order Action Section -->
                                      <div class="order-action">
                                        <% if (order.status === 'Payment Pending') { %>
                                          <button class="btn-small"  data-order-id="<%= order.orderId %>" onclick="retryPayment('<%= order._id %>')">Retry Payment</button>
                                        <% } else if (order.status === 'Processing' || order.status === 'Paid') { %>
                                          <button class="btn-small" onclick="confirmCancelOrder(event,'<%= order._id %>')">Cancel</button>
                                        <% } else if (order.status === 'Shipped') { %>
                                          <button class="btn-small" onclick="confirmCancelOrder(event,'<%= order._id %>')">Cancel</button>
                                        <% } else if (order.status === 'Delivered') { %>
                                          <% const currentDate = new Date(); const deliveredDate = new Date(order.statusDates.Delivered); 
                                            const timeDifference = (currentDate - deliveredDate) / (1000 * 3600 * 24); %>
                                          <% if (timeDifference <= 7) { %>
                                            <button class="btn-small" onclick="confirmReturnOrder(event,'<%= order._id %>')">Return</button>
                                          <% } else { %>
                                            <span class="text-muted">Return Period Expired</span>
                                          <% } %>
                                        <% } else if (order.status === 'Canceled') { %>
                                          <span class="text-muted">Order Canceled</span>
                                        <% } else if (order.status === 'Returned') { %>
                                          <span class="text-muted">Order Returned</span>
                                        <% } else { %>
                                          <span class="text-muted">Cannot cancel</span>
                                        <% } %>
                                      </div>
                                      <!-- "View" button to see order details -->
                                      <a href="/order/<%= order._id %>" class="btn-small" style="text-decoration: none;">View</a>
                                    </td>
                                  </tr>
                                <% }) %>
                              <% } else { %>
                                <tr>
                                  <td colspan="5">No orders found.</td>
                                </tr>
                              <% } %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>


                  <!-- Wallet History Section -->
                  <div class="tab-pane fade" id="wallet" role="tabpanel" aria-labelledby="wallet-tab">
                    <div class="card">
                      <div class="card-header">
                        <h5 class="mb-0">Your Wallet</h5>
                      </div>
                      <div class="card-body wallet-container" style="max-height: 400px; overflow-y: auto;">
                        <!-- Display the available wallet balance -->
                        <div class="wallet-balance mb-3">
                          <h5>Available Balance: ₹<%= walletBalance.toFixed(2) %>
                          </h5>
                        </div>

                        <div class="table-responsive">
                          <table class="table">
                            <thead style="position: sticky; top: 0; background-color: #ffffff; z-index: 1;">
                              <tr>
                                <th>Transaction ID</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Date & Time</th>
                                <th>Status</th>
                              </tr>
                            </thead>
                            <tbody>
                              <% if (walletHistory && walletHistory.length> 0) { %>
                                <% walletHistory.forEach(transaction=> { %>
                                  <tr class="transaction-card">
                                    <td>
                                      <%= transaction._id %>
                                    </td>
                                    <td>
                                      <% if (transaction.transactionType==='cancel' ) { %>
                                        Order Cancelled
                                        <% } else if (transaction.transactionType==='return' ) { %>
                                          Order Returned
                                          <% } else if (transaction.transactionType==='wallet-order' ) { %>
                                            Order Payment
                                            <% } else { %>
                                              Other
                                              <% } %>
                                    </td>
                                    <td>₹<%= transaction.amount.toFixed(2) %>
                                    </td>
                                    <td>
                                      <%= new Date(transaction.createdAt).toLocaleString() %>
                                    </td>
                                    <td>
                                      <% if (transaction.status==='Completed' ) { %>
                                        <span class="text-primary">Completed</span>
                                        <% } else if (transaction.status==='Failed' ) { %>
                                          <span class="text-danger">Failed</span>
                                          <% } else { %>
                                            <span class="text-muted">Pending</span>
                                            <% } %>
                                    </td>
                                  </tr>
                                  <% }) %>
                                    <% } else { %>
                                      <tr>
                                        <td colspan="5" class="text-center">
                                          <p class="mt-3 mb-3 text-muted">No transactions found in your wallet.</p>
                                        </td>
                                      </tr>
                                      <% } %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Add a popup modal for payment options -->
                  <div id="paymentOptionsPopup" class="modal fade" tabindex="-1" aria-hidden="true">
                    <form id="orderForm" action="/retryPayment/:orderId" method="POST">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Choose Payment Method</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <!-- Payment Method Options -->
                                <div class="payment-option mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="cashOnDelivery" name="payment_method" value="cash_on_delivery">
                                        <label class="form-check-label" for="cashOnDelivery">
                                            <span class="payment-label">Cash on Delivery</span>
                                        </label>
                                    </div>
                                </div>
                
                                <div class="payment-option mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="razorPay" name="payment_method" value="razorpay">
                                        <label class="form-check-label" for="razorPay">
                                            <span class="payment-label">Online Payment (Razorpay)</span>
                                        </label>
                                    </div>
                                </div>
                
                                <div class="payment-option mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" id="wallet" name="payment_method" value="wallet">
                                        <label class="form-check-label" for="wallet">
                                            <span class="payment-label">Wallet</span>
                                        </label>
                                    </div>
                                </div>
                
                                <!-- Place Order Button -->
                                <div class="form-group">
                                    <button class="btn btn-dark btn-lg w-100" type="submit">Place Order</button>
                                </div>
                            </div>
                        </div>
                    </div>
                  </form>
                </div>
                
                
                
                  

                  








                  <!-- Other Tabs (Wallet, History, Referral) -->
                  <!-- Similar to the above example -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <%- include("../partials/user/footer") %>
    <style>
      .btn-small {
        display: inline-block;
        padding: 5px 10px;
        background-color: #007bff;
        /* Adjust this color as needed */
        color: #fff;
        border: none;
        border-radius: 5px;
        text-align: center;
        cursor: pointer;
        font-size: 14px;
        margin-top: 5px;
        transition: background-color 0.3s;
      }

      .btn-small:hover {
        background-color: #0056b3;
      }

      .orders-container .btn-small {
        background-color: #577194;
        /* Button color */
        color: white;
        /* Text color */
      }
    </style>
    <style>
      .btn-small {
        display: inline-block;
        padding: 5px 10px;
        min-width: 100px;
        /* Ensure enough space for longer text like 'Retry Payment' */
        height: 30px;
        /* Maintain consistent height */
        background-color: #007bff;
        /* Button color */
        color: #fff;
        /* Text color */
        border: none;
        border-radius: 5px;
        text-align: center;
        cursor: pointer;
        font-size: 14px;
        margin-top: 5px;
        transition: background-color 0.3s, transform 0.2s;
        line-height: 20px;
        /* Vertically align the text */
        white-space: nowrap;
        /* Prevent text wrapping */
      }

      .btn-small:hover {
        background-color: #0056b3;
        transform: scale(1.05);
        /* Slight scale effect on hover */
      }

      .orders-container .btn-small {
        background-color: #577194;
        /* Adjusted button color */
        color: white;
        /* Text color */
      }
    </style>


    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      async function deleteAddress(addressId) {
        const confirmation = await Swal.fire({
          title: 'Are you sure?',
          text: 'This address will be permanently deleted.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, delete it!',
          cancelButtonText: 'No, cancel'
        });

        if (confirmation.isConfirmed) {
          try {
            const response = await fetch(`/deleteAddress/${addressId}`, {
              method: 'DELETE',
              headers: { 'Content-Type': 'application/json' }
            });

            const result = await response.json();

            if (response.ok) {
              await Swal.fire({
                title: 'Deleted!',
                text: result.message,
                icon: 'success',
                confirmButtonText: 'Okay'
              });
              location.reload();
            } else {
              await Swal.fire({
                title: 'Error!',
                text: result.message || 'An error occurred.',
                icon: 'error',
                confirmButtonText: 'Okay'
              });
            }
          } catch (error) {
            await Swal.fire({
              title: 'Error!',
              text: 'An unexpected error occurred.',
              icon: 'error',
              confirmButtonText: 'Okay'
            });
          }
        }
      }
    </script>
    <script>
      async function confirmCancelOrder(event, orderId) {
        event.preventDefault();

        const confirmation = await Swal.fire({
          title: 'Are you sure?',
          text: 'Do you want to  cancel your order?.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, cancel it',
        });

        if (confirmation.isConfirmed) {
          try {
            const response = await fetch(`/cancelOrder/${orderId}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' }
            });

            const result = await response.json();

            if (response.ok) {
              await Swal.fire({
                title: 'Canceled!',
                text: result.message,
                icon: 'success',
                confirmButtonText: 'Okay'
              })
              window.location.href = "/userProfile#orders";
              window.location.reload();
              
            } else {
              await Swal.fire({
                title: 'Error!',
                text: result.message || 'An error occurred.',
                icon: 'error',
                confirmButtonText: 'Okay'
              });
            }
          } catch (error) {
            await Swal.fire({
              title: 'Error!',
              text: 'An unexpected error occurred.',
              icon: 'error',
              confirmButtonText: 'Okay'
            });
          }
        }
      }


      async function confirmReturnOrder(event, orderId) {
        event.preventDefault();

        const confirmation = await Swal.fire({
          title: 'Are you sure?',
          text: 'This action will initiate a return process for your order.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, return it',
        });

        if (confirmation.isConfirmed) {
          try {
            const response = await fetch(`/returnOrder/${orderId}`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' }
            });

            const result = await response.json();

            if (response.ok) {
              await Swal.fire({
                title: 'Returned!',
                text: result.message,
                icon: 'success',
                confirmButtonText: 'Okay'
              });
              window.location.replace= "/userProfile#orders";
            } else {
              await Swal.fire({
                title: 'Error!',
                text: result.message || 'An error occurred.',
                icon: 'error',
                confirmButtonText: 'Okay'
              });
            }
          } catch (error) {
            await Swal.fire({
              title: 'Error!',
              text: 'An unexpected error occurred.',
              icon: 'error',
              confirmButtonText: 'Okay'
            });
          }
        }
      }

    </script>

    <script>
      
function retryPayment(orderId) {
  // Optional: Do something with the orderId if needed, like storing it for the payment process
  console.log(orderId)
  // Show the payment options modal
  var paymentModal = new bootstrap.Modal(document.getElementById('paymentOptionsPopup'));
  paymentModal.show();


      

const form = document.getElementById('orderForm');


            form.addEventListener('submit', async function (e) {
                e.preventDefault();

                // Show a confirmation dialog before proceeding
                Swal.fire({
                    title: 'Are you sure?',
                    text: 'Do you want to place this order? You can review your order details before confirming.',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, Place Order',
                    cancelButtonText: 'No, Cancel',
                    reverseButtons: true
                }).then(async (result) => {
        if (result.isConfirmed) {
            // Proceed if user confirmed the order
            const paymentMethod = document.querySelector('input[name="payment_method"]:checked');
            
            if (!paymentMethod) {
                Swal.fire({
                    title: 'Payment Method Required',
                    text: 'Please select a payment method to place your order.',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }

            const paymentMethodValue = paymentMethod.value;  
            console.log(paymentMethodValue);

                        try {
                            const response = await fetch(`/retryPayment/${orderId}`, {
                                method: "POST",
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    //c_select_address: document.querySelector('#c_select_address').value,
                                    payment_method: paymentMethodValue,
                                    
                                })
                                
                            });

                            //console.log(payment_method)
                            const data = await response.json();
                            console.log(data)
                            if (response.ok) {
                                if (paymentMethodValue === 'razorpay') {
                                    // Trigger Razorpay payment flow
                                    var options = {
                                        "key": "rzp_test_BbOrMS3clwhzdK",
                                        "amount": data.totalAmount * 100,
                                        "currency": "INR",
                                        "name": "Furni",
                                        "description": "Test Transaction",
                                        "order_id": data.razorpayOrderId,
                                        "handler": async function (paymentResponse) {
                                            // Handle payment success
                                            const verifyResponse = await fetch('/verify-payment', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                    payment: paymentResponse,
                                                    order: data.orderId,
                                                }),
                                            });

                                            const verifyData = await verifyResponse.json();
                                            if (verifyResponse.ok) {
                                                Swal.fire({
                                                    title: 'Payment Successful!',
                                                    text: 'Your order has been placed successfully. Redirecting to the shop page...',
                                                    icon: 'success',
                                                    timer: 3000,
                                                    showConfirmButton: false,
                                                }).then(() => {
                                                    window.location.href = `/userProfile`;
                                                });
                                            } else {
                                                Swal.fire({
                                                    title: 'Payment Verification Failed!',
                                                    text: verifyData.message || 'Please try again.',
                                                    icon: 'error',
                                                    confirmButtonText: 'OK',
                                                });
                                            }
                                        },
                                        "prefill": {
                                            "name": "Gaurav Kumar",
                                            "email": "gaurav.kumar@example.com",
                                            "contact": "9000090000"
                                        },
                                        "theme": {
                                            "color": "#3399cc"
                                        },
                                    };
                                    const rzp1 = new Razorpay(options);
                                    rzp1.open();
                                } else if (paymentMethodValue === 'wallet' || paymentMethodValue === 'cash_on_delivery') {
                                    Swal.fire({
                                        title: 'Payment Successful!',
                                        text: 'Your order has been placed successfully. Redirecting to the shop page...',
                                        icon: 'success',
                                        timer: 3000,
                                        showConfirmButton: false,
                                    }).then(() => {
                                        window.location.href = "/userProfile";
                                    });
                                }
                            } else {
                                Swal.fire({
                                    title: 'Order Placement Failed!',
                                    text: data.message || 'Please try again.',
                                    icon: 'error',
                                    confirmButtonText: 'OK',
                                });
                            }
                        } catch (error) {
                            console.error('Error during order placement:', error);
                            Swal.fire({
                                title: 'Error!',
                                text: 'An error occurred while placing your order. Please try again.',
                                icon: 'error',
                                confirmButtonText: 'OK',
                            });
                        }
                    } else {
                        console.log('Order was not placed');
                    }
                });
            });

          }
    </script>